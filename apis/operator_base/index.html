<!-- Elements added to "main.html" will be displayed on all pages -->


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Fourier Spectral Method with PyTorch">
      
      
        <meta name="author" content="Qiang Liu">
      
      
        <link rel="canonical" href="https://qiauil.github.io/torchfsm/apis/operator_base/">
      
      
        <link rel="prev" href="../utils/">
      
      
        <link rel="next" href="../operator_core/">
      
      
      <link rel="icon" href="../../assets/logo/icon_torchfsm.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>9. Base Classes for Operators - TorchFSM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
    <!-- main.html | Added "navigation.instant" support -->
    <link rel="canonical" href=".">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#torchfsm.operator.LinearCoef" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TorchFSM" class="md-header__button md-logo" aria-label="TorchFSM" data-md-component="logo">
      
  <img src="../../assets/logo/icon_torchfsm white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TorchFSM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              9. Base Classes for Operators
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/qiauil/torchfsm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    qiauil/torchfsm
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../theory/" class="md-tabs__link">
        
  
  
    
  
  Theory Introduction

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/introduction/" class="md-tabs__link">
          
  
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../operator/" class="md-tabs__link">
          
  
  
    
  
  APIs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TorchFSM" class="md-nav__button md-logo" aria-label="TorchFSM" data-md-component="logo">
      
  <img src="../../assets/logo/icon_torchfsm white.png" alt="logo">

    </a>
    TorchFSM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/qiauil/torchfsm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    qiauil/torchfsm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Theory Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0. Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2. Evaluate Derivatives
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            2. Evaluate Derivatives
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/call_operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.1. Call the Operator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/derivative_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.2. Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3. Simulations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            3. Simulations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/solve_de/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.1. Solve Differential Equations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2" id="__nav_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.2. Simulation Gallery
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            3.2. Simulation Gallery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2_1" id="__nav_3_4_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.2.1 Simple PDEs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2_1">
            <span class="md-nav__icon md-icon"></span>
            3.2.1 Simple PDEs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/pdes/burgers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Burgers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/pdes/korteweg_de_vries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Korteweg de Vries
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/pdes/kuramoto_sivashinsky/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kuramoto Sivashinsky
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2_2" id="__nav_3_4_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.2.1. Navier-Stokes Simulation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            3.2.1. Navier-Stokes Simulation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/pdes/ns_vorticity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.3.4.1 Vorticity Based
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/pdes/ns_velocity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.3.4.1 Velocity Based
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cheat Sheet
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    APIs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            APIs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. operator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pde/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. pde
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. functional
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. integrator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../field/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. field
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6. plot
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../traj_recorder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7. traj_recorder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8. utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    9. Base Classes for Operators
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    9. Base Classes for Operators
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator.LinearCoef" class="md-nav__link">
    <span class="md-ellipsis">
      LinearCoef
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator.NonlinearFunc" class="md-nav__link">
    <span class="md-ellipsis">
      NonlinearFunc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator.CoreGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      CoreGenerator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator._base._MutableMixIn" class="md-nav__link">
    <span class="md-ellipsis">
      _MutableMixIn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator._base._InverseSolveMixin" class="md-nav__link">
    <span class="md-ellipsis">
      _InverseSolveMixin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator._base._DeAliasMixin" class="md-nav__link">
    <span class="md-ellipsis">
      _DeAliasMixin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator.OperatorLike" class="md-nav__link">
    <span class="md-ellipsis">
      OperatorLike
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator.Operator" class="md-nav__link">
    <span class="md-ellipsis">
      Operator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator.LinearOperator" class="md-nav__link">
    <span class="md-ellipsis">
      LinearOperator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchfsm.operator.NonlinearOperator" class="md-nav__link">
    <span class="md-ellipsis">
      NonlinearOperator
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    10. Cores and Generators for Operators
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            10. Cores and Generators for Operators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operator_core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cores
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operator_generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generators
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>9. Base Classes for Operators</h1>

<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator.LinearCoef" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator.LinearCoef</span>


<a href="#torchfsm.operator.LinearCoef" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract class for linear coefficients.</p>







              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LinearCoef</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for linear coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abstract method to be implemented by subclasses. It should define the linear coefficient tensor.</span>

<span class="sd">        Args:</span>
<span class="sd">            f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">            n_channel (int): Number of channels of the input tensor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            FourierTensor: Linear coefficient tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">nonlinear_like</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">u_fft</span><span class="p">:</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the result out based on the linear coefficient. It is designed to have same pattern as the nonlinear function.</span>

<span class="sd">        Args:</span>
<span class="sd">            u_fft (FourierTensor): Fourier-transformed input tensor.</span>
<span class="sd">            f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">            u (Optional[SpatialTensor]): Corresponding tensor of u_fft in spatial domain. This option aims to avoid repeating the inverse FFT operation in operators.</span>

<span class="sd">        Returns:</span>
<span class="sd">            FourierTensor: Nonlinear-like tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">f_mesh</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">u_fft</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearCoef.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__call__</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#torchfsm.operator.LinearCoef.__call__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__call__</span><span class="p">(</span>
    <span class="nf">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Abstract method to be implemented by subclasses. It should define the linear coefficient tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>f_mesh</code>
            </td>
            <td>
                  <code><span title="torchfsm.mesh.FourierMesh">FourierMesh</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fourier mesh object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_channel</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of channels of the input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>FourierTensor</code></td>            <td>
                  <code><span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Linear coefficient tensor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract method to be implemented by subclasses. It should define the linear coefficient tensor.</span>

<span class="sd">    Args:</span>
<span class="sd">        f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">        n_channel (int): Number of channels of the input tensor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FourierTensor: Linear coefficient tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearCoef.nonlinear_like" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">nonlinear_like</span>


<a href="#torchfsm.operator.LinearCoef.nonlinear_like" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">nonlinear_like</span><span class="p">(</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the result out based on the linear coefficient. It is designed to have same pattern as the nonlinear function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u_fft</code>
            </td>
            <td>
                  <code><span title="torchfsm._type.FourierTensor">FourierTensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fourier-transformed input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>f_mesh</code>
            </td>
            <td>
                  <code><span title="torchfsm.mesh.FourierMesh">FourierMesh</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fourier mesh object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Corresponding tensor of u_fft in spatial domain. This option aims to avoid repeating the inverse FFT operation in operators.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>FourierTensor</code></td>            <td>
                  <code><span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Nonlinear-like tensor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nonlinear_like</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the result out based on the linear coefficient. It is designed to have same pattern as the nonlinear function.</span>

<span class="sd">    Args:</span>
<span class="sd">        u_fft (FourierTensor): Fourier-transformed input tensor.</span>
<span class="sd">        f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">        u (Optional[SpatialTensor]): Corresponding tensor of u_fft in spatial domain. This option aims to avoid repeating the inverse FFT operation in operators.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FourierTensor: Nonlinear-like tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">f_mesh</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">u_fft</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator.NonlinearFunc" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator.NonlinearFunc</span>


<a href="#torchfsm.operator.NonlinearFunc" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract class for nonlinear functions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dealiasing_swtich</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply dealiasing. Default is True.
If True, the dealiased version of u_fft will be input to the function in operator.
If False, the original u_fft will be used.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NonlinearFunc</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for nonlinear functions.</span>

<span class="sd">    Args:</span>
<span class="sd">        dealiasing_swtich (bool): Whether to apply dealiasing. Default is True.</span>
<span class="sd">            If True, the dealiased version of u_fft will be input to the function in operator.</span>
<span class="sd">            If False, the original u_fft will be used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dealiasing_swtich</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dealiasing_swtich</span> <span class="o">=</span> <span class="n">dealiasing_swtich</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">u_fft</span><span class="p">:</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abstract method to be implemented by subclasses. It should define the nonlinear function.</span>

<span class="sd">        Args:</span>
<span class="sd">            u_fft (FourierTensor): Fourier-transformed input tensor.</span>
<span class="sd">            f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">            u (Optional[SpatialTensor]): Corresponding tensor of u_fft in spatial domain. This option aims to avoid repeating the inverse FFT operation in operators.</span>

<span class="sd">        Returns:</span>
<span class="sd">            FourierTensor: Result of the nonlinear function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">spatial_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">u_fft</span><span class="p">:</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the result of the nonlinear function in spatial domain.</span>

<span class="sd">        Args:</span>
<span class="sd">            u_fft (FourierTensor): Fourier-transformed input tensor.</span>
<span class="sd">            f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">            u (Optional[SpatialTensor]): Corresponding tensor of u_fft in spatial domain. This option aims to avoid repeating the inverse FFT operation in operators.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SpatialTensor: Result of the nonlinear function in spatial domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">u_fft</span><span class="p">,</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">u</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearFunc.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__init__</span>


<a href="#torchfsm.operator.NonlinearFunc.__init__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">dealiasing_swtich</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dealiasing_swtich</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dealiasing_swtich</span> <span class="o">=</span> <span class="n">dealiasing_swtich</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearFunc.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__call__</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#torchfsm.operator.NonlinearFunc.__call__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__call__</span><span class="p">(</span>
    <span class="nf">u_fft</span><span class="p">:</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Abstract method to be implemented by subclasses. It should define the nonlinear function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u_fft</code>
            </td>
            <td>
                  <code><span title="torchfsm._type.FourierTensor">FourierTensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fourier-transformed input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>f_mesh</code>
            </td>
            <td>
                  <code><span title="torchfsm.mesh.FourierMesh">FourierMesh</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fourier mesh object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Corresponding tensor of u_fft in spatial domain. This option aims to avoid repeating the inverse FFT operation in operators.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>FourierTensor</code></td>            <td>
                  <code><span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Result of the nonlinear function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract method to be implemented by subclasses. It should define the nonlinear function.</span>

<span class="sd">    Args:</span>
<span class="sd">        u_fft (FourierTensor): Fourier-transformed input tensor.</span>
<span class="sd">        f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">        u (Optional[SpatialTensor]): Corresponding tensor of u_fft in spatial domain. This option aims to avoid repeating the inverse FFT operation in operators.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FourierTensor: Result of the nonlinear function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearFunc.spatial_value" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">spatial_value</span>


<a href="#torchfsm.operator.NonlinearFunc.spatial_value" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">spatial_value</span><span class="p">(</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the result of the nonlinear function in spatial domain.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u_fft</code>
            </td>
            <td>
                  <code><span title="torchfsm._type.FourierTensor">FourierTensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fourier-transformed input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>f_mesh</code>
            </td>
            <td>
                  <code><span title="torchfsm.mesh.FourierMesh">FourierMesh</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fourier mesh object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Corresponding tensor of u_fft in spatial domain. This option aims to avoid repeating the inverse FFT operation in operators.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SpatialTensor</code></td>            <td>
                  <code><span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Result of the nonlinear function in spatial domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">spatial_value</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the result of the nonlinear function in spatial domain.</span>

<span class="sd">    Args:</span>
<span class="sd">        u_fft (FourierTensor): Fourier-transformed input tensor.</span>
<span class="sd">        f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">        u (Optional[SpatialTensor]): Corresponding tensor of u_fft in spatial domain. This option aims to avoid repeating the inverse FFT operation in operators.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SpatialTensor: Result of the nonlinear function in spatial domain.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">u_fft</span><span class="p">,</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">u</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator.CoreGenerator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator.CoreGenerator</span>


<a href="#torchfsm.operator.CoreGenerator" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract class for core generator. A core generator is a callable that generates a linear coefficient or a nonlinear function based on the Fourier mesh and channels of the tensor.</p>







              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CoreGenerator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for core generator. A core generator is a callable that generates a linear coefficient or a nonlinear function based on the Fourier mesh and channels of the tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">LinearCoef</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abstract method to be implemented by subclasses. It should define the core generator.</span>

<span class="sd">        Args:</span>
<span class="sd">            f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">            n_channel (int): Number of channels of the input tensor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[LinearCoef, NonlinearFunc]: Linear coefficient or nonlinear function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.CoreGenerator.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__call__</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#torchfsm.operator.CoreGenerator.__call__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__call__</span><span class="p">(</span>
    <span class="nf">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">LinearCoef</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Abstract method to be implemented by subclasses. It should define the core generator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>f_mesh</code>
            </td>
            <td>
                  <code><span title="torchfsm.mesh.FourierMesh">FourierMesh</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fourier mesh object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_channel</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of channels of the input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="            torchfsm.operator.LinearCoef (torchfsm.operator._base.LinearCoef)" href="#torchfsm.operator.LinearCoef">LinearCoef</a>, <a class="autorefs autorefs-internal" title="            torchfsm.operator.NonlinearFunc (torchfsm.operator._base.NonlinearFunc)" href="#torchfsm.operator.NonlinearFunc">NonlinearFunc</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[LinearCoef, NonlinearFunc]: Linear coefficient or nonlinear function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">f_mesh</span><span class="p">:</span> <span class="n">FourierMesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">LinearCoef</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract method to be implemented by subclasses. It should define the core generator.</span>

<span class="sd">    Args:</span>
<span class="sd">        f_mesh (FourierMesh): Fourier mesh object.</span>
<span class="sd">        n_channel (int): Number of channels of the input tensor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[LinearCoef, NonlinearFunc]: Linear coefficient or nonlinear function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator._base._MutableMixIn" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator._base._MutableMixIn</span>


<a href="#torchfsm.operator._base._MutableMixIn" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">


        <p>Mixin class for mutable operations. This class supports basic arithmetic operations for the operator.</p>







              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">_MutableMixIn</span><span class="p">:</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Mixin class for mutable operations. This class supports basic arithmetic operations for the operator.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._MutableMixIn.__radd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__radd__</span>


<a href="#torchfsm.operator._base._MutableMixIn.__radd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__radd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._MutableMixIn.__iadd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__iadd__</span>


<a href="#torchfsm.operator._base._MutableMixIn.__iadd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__iadd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._MutableMixIn.__sub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__sub__</span>


<a href="#torchfsm.operator._base._MutableMixIn.__sub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__sub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._MutableMixIn.__rsub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rsub__</span>


<a href="#torchfsm.operator._base._MutableMixIn.__rsub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rsub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._MutableMixIn.__isub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__isub__</span>


<a href="#torchfsm.operator._base._MutableMixIn.__isub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__isub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._MutableMixIn.__rmul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rmul__</span>


<a href="#torchfsm.operator._base._MutableMixIn.__rmul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rmul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._MutableMixIn.__imul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__imul__</span>


<a href="#torchfsm.operator._base._MutableMixIn.__imul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__imul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._MutableMixIn.__truediv__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__truediv__</span>


<a href="#torchfsm.operator._base._MutableMixIn.__truediv__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__truediv__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator._base._InverseSolveMixin" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator._base._InverseSolveMixin</span>


<a href="#torchfsm.operator._base._InverseSolveMixin" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">








              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">_InverseSolveMixin</span><span class="p">:</span>
    <span class="n">_state_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
    <span class="n">register_mesh</span><span class="p">:</span> <span class="n">Callable</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Mixin class for inverse solving operations. This class supports solving the linear operator equation.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">b_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]:</span>

<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solve the linear operator equation $Ax = b$, where $A$ is the linear operator and $b$ is the right-hand side.</span>

<span class="sd">        Args:</span>
<span class="sd">            b (Optional[torch.Tensor]): Right-hand side tensor in spatial domain. If None, b_fft should be provided.</span>
<span class="sd">            b_fft (Optional[torch.Tensor]): Right-hand side tensor in Fourier domain. If None, b should be provided.</span>
<span class="sd">            mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. If None, the mesh registered in the operator will be used.</span>
<span class="sd">            n_channel (Optional[int]): Number of channels of $x$. If None, the number of channels registered in the operator will be used.</span>
<span class="sd">            return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[SpatialTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B C H ...&quot;]]: Solution tensor in spatial or Fourier domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;Mesh and n_channel should be given when calling solve&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_channel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mesh</span>
            <span class="n">n_channel</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;n_channel&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">n_channel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">n_channel</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span>
                <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">b_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">b_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">value_fft</span> <span class="o">=</span> <span class="n">b_fft</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value_fft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">value_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator._base._InverseSolveMixin.register_mesh" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">register_mesh</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#torchfsm.operator._base._InverseSolveMixin.register_mesh" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">register_mesh</span><span class="p">:</span> <span class="n">Callable</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Mixin class for inverse solving operations. This class supports solving the linear operator equation.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._InverseSolveMixin.solve" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">solve</span>


<a href="#torchfsm.operator._base._InverseSolveMixin.solve" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">solve</span><span class="p">(</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">b_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Solve the linear operator equation <span class="arithmatex">\(Ax = b\)</span>, where <span class="arithmatex">\(A\)</span> is the linear operator and <span class="arithmatex">\(b\)</span> is the right-hand side.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>b</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right-hand side tensor in spatial domain. If None, b_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>b_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right-hand side tensor in Fourier domain. If None, b should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. If None, the mesh registered in the operator will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_channel</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of channels of <span class="arithmatex">\(x\)</span>. If None, the number of channels registered in the operator will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], FourierTensor["B C H ..."]]: Solution tensor in spatial or Fourier domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">solve</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">b_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]:</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve the linear operator equation $Ax = b$, where $A$ is the linear operator and $b$ is the right-hand side.</span>

<span class="sd">    Args:</span>
<span class="sd">        b (Optional[torch.Tensor]): Right-hand side tensor in spatial domain. If None, b_fft should be provided.</span>
<span class="sd">        b_fft (Optional[torch.Tensor]): Right-hand side tensor in Fourier domain. If None, b should be provided.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. If None, the mesh registered in the operator will be used.</span>
<span class="sd">        n_channel (Optional[int]): Number of channels of $x$. If None, the number of channels registered in the operator will be used.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B C H ...&quot;]]: Solution tensor in spatial or Fourier domain.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;Mesh and n_channel should be given when calling solve&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_channel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mesh</span>
        <span class="n">n_channel</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;n_channel&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">n_channel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">n_channel</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">b_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">b_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">value_fft</span> <span class="o">=</span> <span class="n">b_fft</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value_fft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">value_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator._base._DeAliasMixin" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator._base._DeAliasMixin</span>


<a href="#torchfsm.operator._base._DeAliasMixin" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">








              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">_DeAliasMixin</span><span class="p">:</span>
    <span class="n">_de_aliasing_rate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">_state_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Mixin class for de-aliasing operations. This class supports setting the de-aliasing rate for the nonlinear operator.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">set_de_aliasing_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">de_aliasing_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the de-aliasing rate for the nonlinear operator.</span>
<span class="sd">        Args:</span>
<span class="sd">            de_aliasing_rate (float): De-aliasing rate. Default is 2/3.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_de_aliasing_rate</span> <span class="o">=</span> <span class="n">de_aliasing_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator._base._DeAliasMixin.set_de_aliasing_rate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_de_aliasing_rate</span>


<a href="#torchfsm.operator._base._DeAliasMixin.set_de_aliasing_rate" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_de_aliasing_rate</span><span class="p">(</span><span class="n">de_aliasing_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the de-aliasing rate for the nonlinear operator.
Args:
    de_aliasing_rate (float): De-aliasing rate. Default is &#8532;.</p>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_de_aliasing_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">de_aliasing_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the de-aliasing rate for the nonlinear operator.</span>
<span class="sd">    Args:</span>
<span class="sd">        de_aliasing_rate (float): De-aliasing rate. Default is 2/3.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_de_aliasing_rate</span> <span class="o">=</span> <span class="n">de_aliasing_rate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator.OperatorLike" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator.OperatorLike</span>


<a href="#torchfsm.operator.OperatorLike" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            torchfsm.operator._base._MutableMixIn" href="#torchfsm.operator._base._MutableMixIn">_MutableMixIn</a></code></p>


        <p>Base class for All Operators.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>operator_generators</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.ValueList">ValueList</span>[<span title="torchfsm.operator._base.GeneratorLike">GeneratorLike</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of operator generators. Default is None.
Each generator should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coefs</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of coefficients for each operator generator. Default is None.
If None, all coefficients are set to 1.
The length of the list should match the number of operator generators.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OperatorLike</span><span class="p">(</span><span class="n">_MutableMixIn</span><span class="p">):</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for All Operators.</span>

<span class="sd">    Args:</span>
<span class="sd">        operator_generators (Optional[ValueList[GeneratorLike]]): List of operator generators. Default is None.</span>
<span class="sd">            Each generator should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</span>
<span class="sd">        coefs (Optional[List]): List of coefficients for each operator generator. Default is None.</span>
<span class="sd">            If None, all coefficients are set to 1.</span>
<span class="sd">            The length of the list should match the number of operator generators.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operator_generators</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ValueList</span><span class="p">[</span><span class="n">GeneratorLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f_mesh&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;n_channel&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;linear_coef&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;nonlinear_func&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;integrator&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_de_aliasing_rate</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value_mesh_check_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dim_value</span><span class="p">,</span> <span class="n">dim_mesh</span><span class="p">:</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_integrator</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_etdrk_integrator</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the operator is linear.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the operator is linear, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;Mesh should be registered before checking if the operator is linear&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;nonlinear_func&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_linear_coefs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">linear_coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">LinearCoef</span><span class="p">]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the linear coefficients based on the provided linear coefficient generators.</span>

<span class="sd">        Args:</span>
<span class="sd">            linear_coefs (Optional[Sequence[LinearCoef]]): List of linear coefficient generators.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_coefs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">linear_coefs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">linear_coefs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">coef</span> <span class="o">*</span> <span class="n">op</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;n_channel&quot;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">linear_coefs</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_coefs</span>

    <span class="k">def</span> <span class="nf">_build_nonlinear_funcs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">nonlinear_funcs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">NonlinearFunc</span><span class="p">]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the nonlinear functions based on the provided nonlinear function generators.</span>

<span class="sd">        Args:</span>
<span class="sd">            nonlinear_funcs (Optional[Sequence[NonlinearFunc]]): List of nonlinear function generators.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonlinear_funcs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nonlinear_funcs_all</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_default_freq_threshold</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_de_aliasing_rate</span>
            <span class="p">)</span>

            <span class="k">def</span> <span class="nf">nonlinear_funcs_all</span><span class="p">(</span><span class="n">u_fft</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">dealiased_u_fft</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">dealiased_u</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">nonlinear_funcs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fun</span><span class="o">.</span><span class="n">_dealiasing_swtich</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">dealiased_u_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">dealiased_u_fft</span> <span class="o">=</span> <span class="n">u_fft</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span>
                                <span class="s2">&quot;f_mesh&quot;</span>
                            <span class="p">]</span><span class="o">.</span><span class="n">low_pass_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_de_aliasing_rate</span><span class="p">)</span>
                            <span class="n">dealiased_u</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">dealiased_u_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
                            <span class="p">)</span>
                        <span class="n">result</span> <span class="o">+=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">fun</span><span class="p">(</span>
                            <span class="n">dealiased_u_fft</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">],</span>
                            <span class="n">dealiased_u</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">u_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
                        <span class="n">result</span> <span class="o">+=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">fun</span><span class="p">(</span>
                            <span class="n">u_fft</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">],</span>
                            <span class="n">u</span><span class="p">,</span>
                        <span class="p">)</span>

                <span class="k">return</span> <span class="n">result</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;nonlinear_func&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nonlinear_funcs_all</span>

    <span class="k">def</span> <span class="nf">_build_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the operator based on the linear coefficient and nonlinear function.</span>
<span class="sd">        If both linear coefficient and nonlinear function are None, the operator is set to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;nonlinear_func&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">operator</span><span class="p">(</span><span class="n">u_fft</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_fft</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">operator</span><span class="p">(</span><span class="n">u_fft</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;nonlinear_func&quot;</span><span class="p">](</span><span class="n">u_fft</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;nonlinear_func&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">operator</span><span class="p">(</span><span class="n">u_fft</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_fft</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span>
                    <span class="s2">&quot;nonlinear_func&quot;</span>
                <span class="p">](</span><span class="n">u_fft</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Both linear coefficient and nonlinear function are None. Cannot build operator.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">operator</span>

    <span class="k">def</span> <span class="nf">_build_integrator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the integrator based on the provided time step and integrator type.</span>

<span class="sd">        Args:</span>
<span class="sd">            dt (float): Time step for the integrator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_integrator</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_linear</span><span class="p">:</span>
                <span class="n">solver</span> <span class="o">=</span> <span class="n">ETDRKIntegrator</span><span class="o">.</span><span class="n">ETDRK0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">solver</span> <span class="o">=</span> <span class="n">ETDRKIntegrator</span><span class="o">.</span><span class="n">ETDRK4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_integrator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_etdrk_integrator</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">ETDRKIntegrator</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_etdrk_integrator</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="n">ETDRKIntegrator</span><span class="o">.</span><span class="n">ETDRK0</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_linear</span><span class="p">,</span> <span class="s2">&quot;The ETDRK0 integrator only supports linear term&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">value</span><span class="p">(</span>
                    <span class="n">dt</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">],</span>
                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">linear_coef</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
                        <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">linear_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">value</span><span class="p">(</span>
                    <span class="n">dt</span><span class="p">,</span>
                    <span class="n">linear_coef</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;nonlinear_func&quot;</span><span class="p">],</span>
                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">],</span>
                <span class="s2">&quot;forward&quot;</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">u_fft</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">u_fft</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">RKIntegrator</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_operator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">],</span>
                <span class="s2">&quot;forward&quot;</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">u_fft</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">],</span> <span class="n">u_fft</span><span class="p">,</span> <span class="n">dt</span>
                <span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pre_check</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">FourierMesh</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pre-check the input tensor and mesh. If the mesh is not registered, register it.</span>

<span class="sd">        Args:</span>
<span class="sd">            u (Optional[SpatialTensor]): Input tensor in spatial domain. Default is None.</span>
<span class="sd">            u_fft (Optional[FourierTensor]): Input tensor in Fourier domain. Default is None.</span>
<span class="sd">                At least one of u or u_fft should be provided.</span>
<span class="sd">            mesh (Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]): Mesh information or mesh object. Default is None.</span>
<span class="sd">                If None, the mesh registered in the operator will be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[FourierMesh, int]: Tuple of Fourier mesh and number of channels.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">u_fft</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either u or u_fft should be given&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u_fft</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">u_fft</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;The shape of u and u_fft should be the same&quot;</span>
        <span class="k">assert</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Mesh should be given&quot;</span>
        <span class="n">value_device</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">device</span> <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">u_fft</span><span class="o">.</span><span class="n">device</span>
        <span class="n">value_dtype</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">dtype</span> <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">u_fft</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">MeshGrid</span><span class="p">):</span>
                <span class="n">mesh</span> <span class="o">=</span> <span class="n">FourierMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">value_device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">value_dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mesh</span> <span class="o">=</span> <span class="n">FourierMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
        <span class="n">n_channel</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">u_fft</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">value_shape</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span> <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">u_fft</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">value_shape</span><span class="p">)</span> <span class="o">==</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n_dim</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;the value shape </span><span class="si">{</span><span class="n">value_shape</span><span class="si">}</span><span class="s2"> is not compatible with mesh dim </span><span class="si">{</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_dim</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_dim</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value_shape</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">mesh</span><span class="o">.</span><span class="n">mesh_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expect to have </span><span class="si">{</span><span class="n">mesh</span><span class="o">.</span><span class="n">mesh_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2"> points in dim </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> but got </span><span class="si">{</span><span class="n">value_shape</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value_device</span> <span class="o">==</span> <span class="n">mesh</span><span class="o">.</span><span class="n">device</span>
        <span class="p">),</span> <span class="s2">&quot;The device of mesh </span><span class="si">{}</span><span class="s2"> and the device of value </span><span class="si">{}</span><span class="s2"> are not the same&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">value_device</span>
        <span class="p">)</span>
        <span class="c1"># assert value_dtype==mesh.dtype, &quot;The dtype of mesh {} and the dtype of value {} are not the same&quot;.format(mesh.dtype,value_dtype)</span>
        <span class="c1"># value fft is a complex dtype</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_mesh_check_func</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">value_shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n_dim</span>
        <span class="p">),</span> <span class="s2">&quot;Value and mesh do not match the requirement&quot;</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span>

    <span class="k">def</span> <span class="nf">register_mesh</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">],</span>
        <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register the mesh and number of channels for the operator. Once a mesh is registered, mesh information is not required for integration and operator call.</span>

<span class="sd">        Args:</span>
<span class="sd">            mesh (Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]): Mesh information or mesh object.</span>
<span class="sd">            n_channel (int): Number of channels of the input tensor.</span>
<span class="sd">            device (Optional[torch.device]): Device to which the mesh should be moved. Default is None.</span>
<span class="sd">            dtype (Optional[torch.dtype]): Data type of the mesh. Default is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">):</span>
            <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">mesh</span>
            <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">f_mesh</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">FourierMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;f_mesh&quot;</span><span class="p">:</span> <span class="n">f_mesh</span><span class="p">,</span>
                <span class="s2">&quot;n_channel&quot;</span><span class="p">:</span> <span class="n">n_channel</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">linear_coefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nonlinear_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">generator</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">):</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">LinearCoef</span><span class="p">):</span>
                <span class="n">linear_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">):</span>
                <span class="n">nonlinear_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operator </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2"> is not supported&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span> <span class="o">=</span> <span class="n">nonlinear_funcs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_linear_coefs</span><span class="p">(</span><span class="n">linear_coefs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_nonlinear_funcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">regisiter_additional_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register an additional check function for the value and mesh compatibility.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (Callable[[int, int], bool]): Function that takes the dimension of the value and mesh as input and returns a boolean indicating whether they are compatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value_mesh_check_func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">add_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorLike</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a generator to the operator.</span>

<span class="sd">        Args:</span>
<span class="sd">            generator (GeneratorLike): Generator to be added. It should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</span>
<span class="sd">            coef (float): Coefficient for the generator. Default is 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_integrator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">integrator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="n">ETDRKIntegrator</span><span class="p">,</span> <span class="n">RKIntegrator</span><span class="p">],</span>
        <span class="o">**</span><span class="n">integrator_config</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the integrator for the operator. The integrator is used for time integration of the operator.</span>

<span class="sd">        Args:</span>
<span class="sd">            integrator (Union[Literal[&quot;auto&quot;], ETDRKIntegrator, RKIntegrator]): Integrator to be used. If &quot;auto&quot;, the integrator will be chosen automatically based on the operator type.</span>
<span class="sd">                If &quot;auto&quot;, the integrator will be set as ETDRKIntegrator.ETDRK0 for linear operators and ETDRKIntegrator.ETDRK4 for nonlinear operators.</span>
<span class="sd">            **integrator_config: Additional configuration for the integrator.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">integrator</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
            <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="n">ETDRKIntegrator</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">integrator</span><span class="p">,</span> <span class="n">RKIntegrator</span>
            <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_integrator</span> <span class="o">=</span> <span class="n">integrator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span> <span class="o">=</span> <span class="n">integrator_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">u_0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">u_0_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">progressive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">trajectory_recorder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TrajRecorder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_in_fourier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
            <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
            <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
            <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
        <span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integrate the operator using the provided initial condition and time step.  </span>

<span class="sd">        Args:</span>
<span class="sd">            u_0 (Optional[torch.Tensor]): Initial condition in spatial domain. Default is None.</span>
<span class="sd">            u_0_fft (Optional[torch.Tensor]): Initial condition in Fourier domain. Default is None.</span>
<span class="sd">                At least one of u_0 or u_0_fft should be provided.</span>
<span class="sd">            dt (float): Time step for the integrator. Default is 1.</span>
<span class="sd">            step (int): Number of time steps to integrate. Default is 1.</span>
<span class="sd">            mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">                If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before integration.</span>
<span class="sd">            progressive (bool): If True, show a progress bar during integration. Default is False.</span>
<span class="sd">            trajectory_recorder (Optional[_TrajRecorder]): Trajectory recorder for recording the trajectory during integration. Default is None.</span>
<span class="sd">                If None, no trajectory will be recorded. The function will only return the final frame.</span>
<span class="sd">            return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[SpatialTensor[&quot;B C H ...&quot;], SpatialTensor[&quot;B T C H ...&quot;], FourierTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B T C H ...&quot;]]: Integrated result in spatial or Fourier domain.</span>
<span class="sd">                If trajectory_recorder is provided, the result will be a trajectory tensor of shape (B, T, C, H, ...). Otherwise, the result will be a tensor of shape (B, C, H, ...).</span>
<span class="sd">                If return_in_fourier is True, the result will be in Fourier domain. Otherwise, it will be in spatial domain.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_etdrk_integrator</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">f_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">u_0_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">u_0_fft</span> <span class="o">=</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u_0</span><span class="p">)</span>
        <span class="n">p_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Integrating&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progressive</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p_bar</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
            <span class="n">u_0_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
            <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">return_in_fourier</span> <span class="o">=</span> <span class="n">return_in_fourier</span>
            <span class="k">return</span> <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">trajectory</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">u_0_fft</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the operator with the provided input tensor. The operator will apply the linear coefficient and nonlinear function to the input tensor.</span>

<span class="sd">        Args:</span>
<span class="sd">            u (Optional[SpatialTensor]): Input tensor in spatial domain. Default is None.</span>
<span class="sd">            u_fft (Optional[FourierTensor]): Input tensor in Fourier domain. Default is None.</span>
<span class="sd">                At least one of u or u_fft should be provided.</span>
<span class="sd">            mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">                If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before calling the operator.</span>
<span class="sd">            return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[SpatialTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B C H ...&quot;]]: Result of the operator in spatial or Fourier domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>    

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_operator</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">u_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">u_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">value_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">](</span><span class="n">u_fft</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value_fft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">value_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>

    <span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the operator to the specified device and change the data type.</span>

<span class="sd">        Args:</span>
<span class="sd">            device (Optional[torch.device]): Device to which the operator should be moved. Default is None.</span>
<span class="sd">            dtype (Optional[torch.dtype]): Data type of the operator. Default is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;n_channel&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.OperatorLike.operator_generators" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">operator_generators</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#torchfsm.operator.OperatorLike.operator_generators" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">operator_generators</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.OperatorLike.coefs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">coefs</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#torchfsm.operator.OperatorLike.coefs" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">coefs</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">))</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.OperatorLike.is_linear" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_linear</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#torchfsm.operator.OperatorLike.is_linear" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_linear</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the operator is linear.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the operator is linear, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__radd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__radd__</span>


<a href="#torchfsm.operator.OperatorLike.__radd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__radd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__iadd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__iadd__</span>


<a href="#torchfsm.operator.OperatorLike.__iadd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__iadd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__sub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__sub__</span>


<a href="#torchfsm.operator.OperatorLike.__sub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__sub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__rsub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rsub__</span>


<a href="#torchfsm.operator.OperatorLike.__rsub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rsub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__isub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__isub__</span>


<a href="#torchfsm.operator.OperatorLike.__isub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__isub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__rmul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rmul__</span>


<a href="#torchfsm.operator.OperatorLike.__rmul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rmul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__imul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__imul__</span>


<a href="#torchfsm.operator.OperatorLike.__imul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__imul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__truediv__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__truediv__</span>


<a href="#torchfsm.operator.OperatorLike.__truediv__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__truediv__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__init__</span>


<a href="#torchfsm.operator.OperatorLike.__init__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span>
    <span class="nf">operator_generators</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">ValueList</span><span class="p">[</span><span class="n">GeneratorLike</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operator_generators</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ValueList</span><span class="p">[</span><span class="n">GeneratorLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;f_mesh&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;n_channel&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;linear_coef&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;nonlinear_func&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;integrator&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_de_aliasing_rate</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_value_mesh_check_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dim_value</span><span class="p">,</span> <span class="n">dim_mesh</span><span class="p">:</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_is_etdrk_integrator</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.register_mesh" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">register_mesh</span>


<a href="#torchfsm.operator.OperatorLike.register_mesh" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">register_mesh</span><span class="p">(</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
        <span class="n">MeshGrid</span><span class="p">,</span>
        <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register the mesh and number of channels for the operator. Once a mesh is registered, mesh information is not required for integration and operator call.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_channel</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of channels of the input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.device">device</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to which the mesh should be moved. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.dtype">dtype</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the mesh. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">register_mesh</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">],</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register the mesh and number of channels for the operator. Once a mesh is registered, mesh information is not required for integration and operator call.</span>

<span class="sd">    Args:</span>
<span class="sd">        mesh (Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]): Mesh information or mesh object.</span>
<span class="sd">        n_channel (int): Number of channels of the input tensor.</span>
<span class="sd">        device (Optional[torch.device]): Device to which the mesh should be moved. Default is None.</span>
<span class="sd">        dtype (Optional[torch.dtype]): Data type of the mesh. Default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">):</span>
        <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">mesh</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f_mesh</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">FourierMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;f_mesh&quot;</span><span class="p">:</span> <span class="n">f_mesh</span><span class="p">,</span>
            <span class="s2">&quot;n_channel&quot;</span><span class="p">:</span> <span class="n">n_channel</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">linear_coefs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nonlinear_funcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">generator</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">LinearCoef</span><span class="p">):</span>
            <span class="n">linear_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">):</span>
            <span class="n">nonlinear_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operator </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2"> is not supported&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span> <span class="o">=</span> <span class="n">nonlinear_funcs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_linear_coefs</span><span class="p">(</span><span class="n">linear_coefs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_nonlinear_funcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.regisiter_additional_check" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">regisiter_additional_check</span>


<a href="#torchfsm.operator.OperatorLike.regisiter_additional_check" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">regisiter_additional_check</span><span class="p">(</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register an additional check function for the value and mesh compatibility.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="int">int</span>, <span title="int">int</span>], <span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that takes the dimension of the value and mesh as input and returns a boolean indicating whether they are compatible.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">regisiter_additional_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register an additional check function for the value and mesh compatibility.</span>

<span class="sd">    Args:</span>
<span class="sd">        func (Callable[[int, int], bool]): Function that takes the dimension of the value and mesh as input and returns a boolean indicating whether they are compatible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_value_mesh_check_func</span> <span class="o">=</span> <span class="n">func</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.add_generator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_generator</span>


<a href="#torchfsm.operator.OperatorLike.add_generator" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_generator</span><span class="p">(</span><span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorLike</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a generator to the operator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>generator</code>
            </td>
            <td>
                  <code><span title="torchfsm.operator._base.GeneratorLike">GeneratorLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generator to be added. It should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coef</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coefficient for the generator. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorLike</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a generator to the operator.</span>

<span class="sd">    Args:</span>
<span class="sd">        generator (GeneratorLike): Generator to be added. It should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</span>
<span class="sd">        coef (float): Coefficient for the generator. Default is 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.set_integrator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_integrator</span>


<a href="#torchfsm.operator.OperatorLike.set_integrator" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_integrator</span><span class="p">(</span>
    <span class="n">integrator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="n">ETDRKIntegrator</span><span class="p">,</span> <span class="n">RKIntegrator</span>
    <span class="p">],</span>
    <span class="o">**</span><span class="n">integrator_config</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the integrator for the operator. The integrator is used for time integration of the operator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>integrator</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;auto&#39;], <a class="autorefs autorefs-internal" title="            torchfsm.integrator.ETDRKIntegrator" href="../integrator/#torchfsm.integrator.ETDRKIntegrator">ETDRKIntegrator</a>, <a class="autorefs autorefs-internal" title="            torchfsm.integrator.RKIntegrator" href="../integrator/#torchfsm.integrator.RKIntegrator">RKIntegrator</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integrator to be used. If "auto", the integrator will be chosen automatically based on the operator type.
If "auto", the integrator will be set as ETDRKIntegrator.ETDRK0 for linear operators and ETDRKIntegrator.ETDRK4 for nonlinear operators.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**integrator_config</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional configuration for the integrator.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_integrator</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">integrator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="n">ETDRKIntegrator</span><span class="p">,</span> <span class="n">RKIntegrator</span><span class="p">],</span>
    <span class="o">**</span><span class="n">integrator_config</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the integrator for the operator. The integrator is used for time integration of the operator.</span>

<span class="sd">    Args:</span>
<span class="sd">        integrator (Union[Literal[&quot;auto&quot;], ETDRKIntegrator, RKIntegrator]): Integrator to be used. If &quot;auto&quot;, the integrator will be chosen automatically based on the operator type.</span>
<span class="sd">            If &quot;auto&quot;, the integrator will be set as ETDRKIntegrator.ETDRK0 for linear operators and ETDRKIntegrator.ETDRK4 for nonlinear operators.</span>
<span class="sd">        **integrator_config: Additional configuration for the integrator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">integrator</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="n">ETDRKIntegrator</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">integrator</span><span class="p">,</span> <span class="n">RKIntegrator</span>
        <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator</span> <span class="o">=</span> <span class="n">integrator</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span> <span class="o">=</span> <span class="n">integrator_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.integrate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">integrate</span>


<a href="#torchfsm.operator.OperatorLike.integrate" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">integrate</span><span class="p">(</span>
    <span class="n">u_0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_0_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progressive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">trajectory_recorder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TrajRecorder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
    <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Integrate the operator using the provided initial condition and time step.  </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u_0</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial condition in spatial domain. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_0_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial condition in Fourier domain. Default is None.
At least one of u_0 or u_0_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dt</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time step for the integrator. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of time steps to integrate. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. Default is None.
If None, the mesh registered in the operator will be used. You can use <code>register_mesh</code> to register a mesh before integration.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progressive</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, show a progress bar during integration. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trajectory_recorder</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            torchfsm.traj_recorder._TrajRecorder" href="../traj_recorder/#torchfsm.traj_recorder._TrajRecorder">_TrajRecorder</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Trajectory recorder for recording the trajectory during integration. Default is None.
If None, no trajectory will be recorded. The function will only return the final frame.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B T C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B T C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], SpatialTensor["B T C H ..."], FourierTensor["B C H ..."], FourierTensor["B T C H ..."]]: Integrated result in spatial or Fourier domain.
If trajectory_recorder is provided, the result will be a trajectory tensor of shape (B, T, C, H, ...). Otherwise, the result will be a tensor of shape (B, C, H, ...).
If return_in_fourier is True, the result will be in Fourier domain. Otherwise, it will be in spatial domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u_0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_0_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progressive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">trajectory_recorder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TrajRecorder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
        <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integrate the operator using the provided initial condition and time step.  </span>

<span class="sd">    Args:</span>
<span class="sd">        u_0 (Optional[torch.Tensor]): Initial condition in spatial domain. Default is None.</span>
<span class="sd">        u_0_fft (Optional[torch.Tensor]): Initial condition in Fourier domain. Default is None.</span>
<span class="sd">            At least one of u_0 or u_0_fft should be provided.</span>
<span class="sd">        dt (float): Time step for the integrator. Default is 1.</span>
<span class="sd">        step (int): Number of time steps to integrate. Default is 1.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">            If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before integration.</span>
<span class="sd">        progressive (bool): If True, show a progress bar during integration. Default is False.</span>
<span class="sd">        trajectory_recorder (Optional[_TrajRecorder]): Trajectory recorder for recording the trajectory during integration. Default is None.</span>
<span class="sd">            If None, no trajectory will be recorded. The function will only return the final frame.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], SpatialTensor[&quot;B T C H ...&quot;], FourierTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B T C H ...&quot;]]: Integrated result in spatial or Fourier domain.</span>
<span class="sd">            If trajectory_recorder is provided, the result will be a trajectory tensor of shape (B, T, C, H, ...). Otherwise, the result will be a tensor of shape (B, C, H, ...).</span>
<span class="sd">            If return_in_fourier is True, the result will be in Fourier domain. Otherwise, it will be in spatial domain.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_etdrk_integrator</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">f_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">u_0_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u_0_fft</span> <span class="o">=</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u_0</span><span class="p">)</span>
    <span class="n">p_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Integrating&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progressive</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p_bar</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
        <span class="n">u_0_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
        <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">return_in_fourier</span> <span class="o">=</span> <span class="n">return_in_fourier</span>
        <span class="k">return</span> <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">trajectory</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">u_0_fft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__call__</span>


<a href="#torchfsm.operator.OperatorLike.__call__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__call__</span><span class="p">(</span>
    <span class="nf">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Call the operator with the provided input tensor. The operator will apply the linear coefficient and nonlinear function to the input tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor in spatial domain. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.FourierTensor">FourierTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor in Fourier domain. Default is None.
At least one of u or u_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. Default is None.
If None, the mesh registered in the operator will be used. You can use <code>register_mesh</code> to register a mesh before calling the operator.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], FourierTensor["B C H ..."]]: Result of the operator in spatial or Fourier domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the operator with the provided input tensor. The operator will apply the linear coefficient and nonlinear function to the input tensor.</span>

<span class="sd">    Args:</span>
<span class="sd">        u (Optional[SpatialTensor]): Input tensor in spatial domain. Default is None.</span>
<span class="sd">        u_fft (Optional[FourierTensor]): Input tensor in Fourier domain. Default is None.</span>
<span class="sd">            At least one of u or u_fft should be provided.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">            If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before calling the operator.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B C H ...&quot;]]: Result of the operator in spatial or Fourier domain.</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_operator</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">u_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">value_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">](</span><span class="n">u_fft</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value_fft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">value_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.OperatorLike.to" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to</span>


<a href="#torchfsm.operator.OperatorLike.to" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Move the operator to the specified device and change the data type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.device">device</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to which the operator should be moved. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.dtype">dtype</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the operator. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move the operator to the specified device and change the data type.</span>

<span class="sd">    Args:</span>
<span class="sd">        device (Optional[torch.device]): Device to which the operator should be moved. Default is None.</span>
<span class="sd">        dtype (Optional[torch.dtype]): Data type of the operator. Default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;n_channel&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator.Operator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator.Operator</span>


<a href="#torchfsm.operator.Operator" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            torchfsm.operator.OperatorLike (torchfsm.operator._base.OperatorLike)" href="#torchfsm.operator.OperatorLike">OperatorLike</a></code>, <code><a class="autorefs autorefs-internal" title="            torchfsm.operator._base._DeAliasMixin" href="#torchfsm.operator._base._DeAliasMixin">_DeAliasMixin</a></code></p>


        <p>Operator class for linear and nonlinear operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>operator_generators</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.ValueList">ValueList</span>[<span title="torchfsm.operator._base.GeneratorLike">GeneratorLike</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of operator generators. Default is None.
Each generator should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coefs</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of coefficients for each operator generator. Default is None.
If None, all coefficients are set to 1.
The length of the list should match the number of operator generators.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Operator</span><span class="p">(</span><span class="n">OperatorLike</span><span class="p">,</span> <span class="n">_DeAliasMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Operator class for linear and nonlinear operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        operator_generators (Optional[ValueList[GeneratorLike]]): List of operator generators. Default is None.</span>
<span class="sd">            Each generator should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</span>
<span class="sd">        coefs (Optional[List]): List of coefficients for each operator generator. Default is None.</span>
<span class="sd">            If None, all coefficients are set to 1.</span>
<span class="sd">            The length of the list should match the number of operator generators.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operator_generators</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ValueList</span><span class="p">[</span><span class="n">GeneratorLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">,</span> <span class="n">coefs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span>
                <span class="o">+</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">_ExplicitSourceCore</span><span class="p">(</span><span class="n">other</span><span class="p">)],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="n">coef</span> <span class="o">*</span> <span class="n">other</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">coef</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.Operator.operator_generators" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">operator_generators</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#torchfsm.operator.Operator.operator_generators" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">operator_generators</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.Operator.coefs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">coefs</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#torchfsm.operator.Operator.coefs" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">coefs</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">))</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.Operator.is_linear" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_linear</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#torchfsm.operator.Operator.is_linear" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_linear</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the operator is linear.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the operator is linear, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.set_de_aliasing_rate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_de_aliasing_rate</span>


<a href="#torchfsm.operator.Operator.set_de_aliasing_rate" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_de_aliasing_rate</span><span class="p">(</span><span class="n">de_aliasing_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the de-aliasing rate for the nonlinear operator.
Args:
    de_aliasing_rate (float): De-aliasing rate. Default is &#8532;.</p>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_de_aliasing_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">de_aliasing_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the de-aliasing rate for the nonlinear operator.</span>
<span class="sd">    Args:</span>
<span class="sd">        de_aliasing_rate (float): De-aliasing rate. Default is 2/3.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_de_aliasing_rate</span> <span class="o">=</span> <span class="n">de_aliasing_rate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__radd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__radd__</span>


<a href="#torchfsm.operator.Operator.__radd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__radd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__iadd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__iadd__</span>


<a href="#torchfsm.operator.Operator.__iadd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__iadd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__sub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__sub__</span>


<a href="#torchfsm.operator.Operator.__sub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__sub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__rsub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rsub__</span>


<a href="#torchfsm.operator.Operator.__rsub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rsub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__isub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__isub__</span>


<a href="#torchfsm.operator.Operator.__isub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__isub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__rmul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rmul__</span>


<a href="#torchfsm.operator.Operator.__rmul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rmul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__imul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__imul__</span>


<a href="#torchfsm.operator.Operator.__imul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__imul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__truediv__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__truediv__</span>


<a href="#torchfsm.operator.Operator.__truediv__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__truediv__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.register_mesh" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">register_mesh</span>


<a href="#torchfsm.operator.Operator.register_mesh" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">register_mesh</span><span class="p">(</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
        <span class="n">MeshGrid</span><span class="p">,</span>
        <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register the mesh and number of channels for the operator. Once a mesh is registered, mesh information is not required for integration and operator call.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_channel</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of channels of the input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.device">device</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to which the mesh should be moved. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.dtype">dtype</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the mesh. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">register_mesh</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">],</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register the mesh and number of channels for the operator. Once a mesh is registered, mesh information is not required for integration and operator call.</span>

<span class="sd">    Args:</span>
<span class="sd">        mesh (Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]): Mesh information or mesh object.</span>
<span class="sd">        n_channel (int): Number of channels of the input tensor.</span>
<span class="sd">        device (Optional[torch.device]): Device to which the mesh should be moved. Default is None.</span>
<span class="sd">        dtype (Optional[torch.dtype]): Data type of the mesh. Default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">):</span>
        <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">mesh</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f_mesh</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">FourierMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;f_mesh&quot;</span><span class="p">:</span> <span class="n">f_mesh</span><span class="p">,</span>
            <span class="s2">&quot;n_channel&quot;</span><span class="p">:</span> <span class="n">n_channel</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">linear_coefs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nonlinear_funcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">generator</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">LinearCoef</span><span class="p">):</span>
            <span class="n">linear_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">):</span>
            <span class="n">nonlinear_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operator </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2"> is not supported&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span> <span class="o">=</span> <span class="n">nonlinear_funcs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_linear_coefs</span><span class="p">(</span><span class="n">linear_coefs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_nonlinear_funcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.regisiter_additional_check" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">regisiter_additional_check</span>


<a href="#torchfsm.operator.Operator.regisiter_additional_check" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">regisiter_additional_check</span><span class="p">(</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register an additional check function for the value and mesh compatibility.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="int">int</span>, <span title="int">int</span>], <span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that takes the dimension of the value and mesh as input and returns a boolean indicating whether they are compatible.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">regisiter_additional_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register an additional check function for the value and mesh compatibility.</span>

<span class="sd">    Args:</span>
<span class="sd">        func (Callable[[int, int], bool]): Function that takes the dimension of the value and mesh as input and returns a boolean indicating whether they are compatible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_value_mesh_check_func</span> <span class="o">=</span> <span class="n">func</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.add_generator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_generator</span>


<a href="#torchfsm.operator.Operator.add_generator" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_generator</span><span class="p">(</span><span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorLike</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a generator to the operator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>generator</code>
            </td>
            <td>
                  <code><span title="torchfsm.operator._base.GeneratorLike">GeneratorLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generator to be added. It should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coef</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coefficient for the generator. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorLike</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a generator to the operator.</span>

<span class="sd">    Args:</span>
<span class="sd">        generator (GeneratorLike): Generator to be added. It should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</span>
<span class="sd">        coef (float): Coefficient for the generator. Default is 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.set_integrator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_integrator</span>


<a href="#torchfsm.operator.Operator.set_integrator" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_integrator</span><span class="p">(</span>
    <span class="n">integrator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="n">ETDRKIntegrator</span><span class="p">,</span> <span class="n">RKIntegrator</span>
    <span class="p">],</span>
    <span class="o">**</span><span class="n">integrator_config</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the integrator for the operator. The integrator is used for time integration of the operator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>integrator</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;auto&#39;], <a class="autorefs autorefs-internal" title="            torchfsm.integrator.ETDRKIntegrator" href="../integrator/#torchfsm.integrator.ETDRKIntegrator">ETDRKIntegrator</a>, <a class="autorefs autorefs-internal" title="            torchfsm.integrator.RKIntegrator" href="../integrator/#torchfsm.integrator.RKIntegrator">RKIntegrator</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integrator to be used. If "auto", the integrator will be chosen automatically based on the operator type.
If "auto", the integrator will be set as ETDRKIntegrator.ETDRK0 for linear operators and ETDRKIntegrator.ETDRK4 for nonlinear operators.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**integrator_config</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional configuration for the integrator.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_integrator</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">integrator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="n">ETDRKIntegrator</span><span class="p">,</span> <span class="n">RKIntegrator</span><span class="p">],</span>
    <span class="o">**</span><span class="n">integrator_config</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the integrator for the operator. The integrator is used for time integration of the operator.</span>

<span class="sd">    Args:</span>
<span class="sd">        integrator (Union[Literal[&quot;auto&quot;], ETDRKIntegrator, RKIntegrator]): Integrator to be used. If &quot;auto&quot;, the integrator will be chosen automatically based on the operator type.</span>
<span class="sd">            If &quot;auto&quot;, the integrator will be set as ETDRKIntegrator.ETDRK0 for linear operators and ETDRKIntegrator.ETDRK4 for nonlinear operators.</span>
<span class="sd">        **integrator_config: Additional configuration for the integrator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">integrator</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="n">ETDRKIntegrator</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">integrator</span><span class="p">,</span> <span class="n">RKIntegrator</span>
        <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator</span> <span class="o">=</span> <span class="n">integrator</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span> <span class="o">=</span> <span class="n">integrator_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.integrate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">integrate</span>


<a href="#torchfsm.operator.Operator.integrate" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">integrate</span><span class="p">(</span>
    <span class="n">u_0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_0_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progressive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">trajectory_recorder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TrajRecorder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
    <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Integrate the operator using the provided initial condition and time step.  </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u_0</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial condition in spatial domain. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_0_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial condition in Fourier domain. Default is None.
At least one of u_0 or u_0_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dt</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time step for the integrator. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of time steps to integrate. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. Default is None.
If None, the mesh registered in the operator will be used. You can use <code>register_mesh</code> to register a mesh before integration.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progressive</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, show a progress bar during integration. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trajectory_recorder</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            torchfsm.traj_recorder._TrajRecorder" href="../traj_recorder/#torchfsm.traj_recorder._TrajRecorder">_TrajRecorder</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Trajectory recorder for recording the trajectory during integration. Default is None.
If None, no trajectory will be recorded. The function will only return the final frame.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B T C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B T C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], SpatialTensor["B T C H ..."], FourierTensor["B C H ..."], FourierTensor["B T C H ..."]]: Integrated result in spatial or Fourier domain.
If trajectory_recorder is provided, the result will be a trajectory tensor of shape (B, T, C, H, ...). Otherwise, the result will be a tensor of shape (B, C, H, ...).
If return_in_fourier is True, the result will be in Fourier domain. Otherwise, it will be in spatial domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u_0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_0_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progressive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">trajectory_recorder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TrajRecorder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
        <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integrate the operator using the provided initial condition and time step.  </span>

<span class="sd">    Args:</span>
<span class="sd">        u_0 (Optional[torch.Tensor]): Initial condition in spatial domain. Default is None.</span>
<span class="sd">        u_0_fft (Optional[torch.Tensor]): Initial condition in Fourier domain. Default is None.</span>
<span class="sd">            At least one of u_0 or u_0_fft should be provided.</span>
<span class="sd">        dt (float): Time step for the integrator. Default is 1.</span>
<span class="sd">        step (int): Number of time steps to integrate. Default is 1.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">            If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before integration.</span>
<span class="sd">        progressive (bool): If True, show a progress bar during integration. Default is False.</span>
<span class="sd">        trajectory_recorder (Optional[_TrajRecorder]): Trajectory recorder for recording the trajectory during integration. Default is None.</span>
<span class="sd">            If None, no trajectory will be recorded. The function will only return the final frame.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], SpatialTensor[&quot;B T C H ...&quot;], FourierTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B T C H ...&quot;]]: Integrated result in spatial or Fourier domain.</span>
<span class="sd">            If trajectory_recorder is provided, the result will be a trajectory tensor of shape (B, T, C, H, ...). Otherwise, the result will be a tensor of shape (B, C, H, ...).</span>
<span class="sd">            If return_in_fourier is True, the result will be in Fourier domain. Otherwise, it will be in spatial domain.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_etdrk_integrator</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">f_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">u_0_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u_0_fft</span> <span class="o">=</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u_0</span><span class="p">)</span>
    <span class="n">p_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Integrating&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progressive</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p_bar</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
        <span class="n">u_0_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
        <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">return_in_fourier</span> <span class="o">=</span> <span class="n">return_in_fourier</span>
        <span class="k">return</span> <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">trajectory</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">u_0_fft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__call__</span>


<a href="#torchfsm.operator.Operator.__call__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__call__</span><span class="p">(</span>
    <span class="nf">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Call the operator with the provided input tensor. The operator will apply the linear coefficient and nonlinear function to the input tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor in spatial domain. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.FourierTensor">FourierTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor in Fourier domain. Default is None.
At least one of u or u_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. Default is None.
If None, the mesh registered in the operator will be used. You can use <code>register_mesh</code> to register a mesh before calling the operator.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], FourierTensor["B C H ..."]]: Result of the operator in spatial or Fourier domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the operator with the provided input tensor. The operator will apply the linear coefficient and nonlinear function to the input tensor.</span>

<span class="sd">    Args:</span>
<span class="sd">        u (Optional[SpatialTensor]): Input tensor in spatial domain. Default is None.</span>
<span class="sd">        u_fft (Optional[FourierTensor]): Input tensor in Fourier domain. Default is None.</span>
<span class="sd">            At least one of u or u_fft should be provided.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">            If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before calling the operator.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B C H ...&quot;]]: Result of the operator in spatial or Fourier domain.</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_operator</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">u_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">value_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">](</span><span class="n">u_fft</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value_fft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">value_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.to" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to</span>


<a href="#torchfsm.operator.Operator.to" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Move the operator to the specified device and change the data type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.device">device</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to which the operator should be moved. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.dtype">dtype</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the operator. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move the operator to the specified device and change the data type.</span>

<span class="sd">    Args:</span>
<span class="sd">        device (Optional[torch.device]): Device to which the operator should be moved. Default is None.</span>
<span class="sd">        dtype (Optional[torch.dtype]): Data type of the operator. Default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;n_channel&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__init__</span>


<a href="#torchfsm.operator.Operator.__init__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span>
    <span class="nf">operator_generators</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">ValueList</span><span class="p">[</span><span class="n">GeneratorLike</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operator_generators</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ValueList</span><span class="p">[</span><span class="n">GeneratorLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">,</span> <span class="n">coefs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__add__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__add__</span>


<a href="#torchfsm.operator.Operator.__add__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__add__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span>
            <span class="o">+</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">_ExplicitSourceCore</span><span class="p">(</span><span class="n">other</span><span class="p">)],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__mul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__mul__</span>


<a href="#torchfsm.operator.Operator.__mul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__mul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="n">coef</span> <span class="o">*</span> <span class="n">other</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.Operator.__neg__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__neg__</span>


<a href="#torchfsm.operator.Operator.__neg__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__neg__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">798</span>
<span class="normal">799</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">coef</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator.LinearOperator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator.LinearOperator</span>


<a href="#torchfsm.operator.LinearOperator" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            torchfsm.operator.OperatorLike (torchfsm.operator._base.OperatorLike)" href="#torchfsm.operator.OperatorLike">OperatorLike</a></code>, <code><a class="autorefs autorefs-internal" title="            torchfsm.operator._base._InverseSolveMixin" href="#torchfsm.operator._base._InverseSolveMixin">_InverseSolveMixin</a></code></p>


        <p>Operators that contain only linear operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>linear_coef</code>
            </td>
            <td>
                  <code><span title="torchfsm._type.ValueList">ValueList</span>[<span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="            torchfsm.operator.LinearCoef (torchfsm.operator._base.LinearCoef)" href="#torchfsm.operator.LinearCoef">LinearCoef</a>, <span title="torchfsm.operator._base.GeneratorLike">GeneratorLike</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of linear coefficient generators. Default is None.
Each generator should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coefs</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of coefficients for each linear coefficient generator. Default is None.
If None, all coefficients are set to 1.
The length of the list should match the number of linear coefficient generators.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LinearOperator</span><span class="p">(</span><span class="n">OperatorLike</span><span class="p">,</span> <span class="n">_InverseSolveMixin</span><span class="p">):</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Operators that contain only linear operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        linear_coef (ValueList[Union[LinearCoef, GeneratorLike]]): List of linear coefficient generators. Default is None.</span>
<span class="sd">            Each generator should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient.</span>
<span class="sd">        coefs (Optional[List]): List of coefficients for each linear coefficient generator. Default is None.</span>
<span class="sd">            If None, all coefficients are set to 1.</span>
<span class="sd">            The length of the list should match the number of linear coefficient generators.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">linear_coef</span><span class="p">:</span> <span class="n">ValueList</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">LinearCoef</span><span class="p">,</span> <span class="n">GeneratorLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linear_coef</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">linear_coef</span> <span class="o">=</span> <span class="p">[</span><span class="n">linear_coef</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">operator_generators</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">linear_coef_i</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linear_coef_i</span><span class="p">,</span> <span class="n">LinearCoef</span><span class="p">)</span>
                    <span class="k">else</span> <span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">linear_coef_i</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">linear_coef_i</span> <span class="ow">in</span> <span class="n">linear_coef</span>
            <span class="p">],</span>
            <span class="n">coefs</span><span class="o">=</span><span class="n">coefs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">LinearOperator</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">LinearOperator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span>
                <span class="o">+</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">_ExplicitSourceCore</span><span class="p">(</span><span class="n">other</span><span class="p">)],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">LinearOperator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="n">coef</span> <span class="o">*</span> <span class="n">other</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">LinearOperator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">coef</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.LinearOperator.operator_generators" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">operator_generators</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#torchfsm.operator.LinearOperator.operator_generators" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">operator_generators</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.LinearOperator.coefs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">coefs</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#torchfsm.operator.LinearOperator.coefs" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">coefs</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">))</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.LinearOperator.is_linear" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_linear</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#torchfsm.operator.LinearOperator.is_linear" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_linear</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.register_mesh" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">register_mesh</span>


<a href="#torchfsm.operator.LinearOperator.register_mesh" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">register_mesh</span><span class="p">(</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
        <span class="n">MeshGrid</span><span class="p">,</span>
        <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register the mesh and number of channels for the operator. Once a mesh is registered, mesh information is not required for integration and operator call.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_channel</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of channels of the input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.device">device</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to which the mesh should be moved. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.dtype">dtype</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the mesh. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">register_mesh</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">],</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register the mesh and number of channels for the operator. Once a mesh is registered, mesh information is not required for integration and operator call.</span>

<span class="sd">    Args:</span>
<span class="sd">        mesh (Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]): Mesh information or mesh object.</span>
<span class="sd">        n_channel (int): Number of channels of the input tensor.</span>
<span class="sd">        device (Optional[torch.device]): Device to which the mesh should be moved. Default is None.</span>
<span class="sd">        dtype (Optional[torch.dtype]): Data type of the mesh. Default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">):</span>
        <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">mesh</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f_mesh</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">FourierMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;f_mesh&quot;</span><span class="p">:</span> <span class="n">f_mesh</span><span class="p">,</span>
            <span class="s2">&quot;n_channel&quot;</span><span class="p">:</span> <span class="n">n_channel</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">linear_coefs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nonlinear_funcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">generator</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">LinearCoef</span><span class="p">):</span>
            <span class="n">linear_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">):</span>
            <span class="n">nonlinear_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operator </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2"> is not supported&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span> <span class="o">=</span> <span class="n">nonlinear_funcs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_linear_coefs</span><span class="p">(</span><span class="n">linear_coefs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_nonlinear_funcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.solve" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">solve</span>


<a href="#torchfsm.operator.LinearOperator.solve" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">solve</span><span class="p">(</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">b_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Solve the linear operator equation <span class="arithmatex">\(Ax = b\)</span>, where <span class="arithmatex">\(A\)</span> is the linear operator and <span class="arithmatex">\(b\)</span> is the right-hand side.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>b</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right-hand side tensor in spatial domain. If None, b_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>b_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right-hand side tensor in Fourier domain. If None, b should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. If None, the mesh registered in the operator will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_channel</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of channels of <span class="arithmatex">\(x\)</span>. If None, the number of channels registered in the operator will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], FourierTensor["B C H ..."]]: Solution tensor in spatial or Fourier domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">solve</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">b_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]:</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve the linear operator equation $Ax = b$, where $A$ is the linear operator and $b$ is the right-hand side.</span>

<span class="sd">    Args:</span>
<span class="sd">        b (Optional[torch.Tensor]): Right-hand side tensor in spatial domain. If None, b_fft should be provided.</span>
<span class="sd">        b_fft (Optional[torch.Tensor]): Right-hand side tensor in Fourier domain. If None, b should be provided.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. If None, the mesh registered in the operator will be used.</span>
<span class="sd">        n_channel (Optional[int]): Number of channels of $x$. If None, the number of channels registered in the operator will be used.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B C H ...&quot;]]: Solution tensor in spatial or Fourier domain.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;Mesh and n_channel should be given when calling solve&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_channel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mesh</span>
        <span class="n">n_channel</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;n_channel&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">n_channel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">n_channel</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;linear_coef&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">b_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">b_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">value_fft</span> <span class="o">=</span> <span class="n">b_fft</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;invert_linear_coef&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value_fft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">value_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__radd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__radd__</span>


<a href="#torchfsm.operator.LinearOperator.__radd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__radd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__iadd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__iadd__</span>


<a href="#torchfsm.operator.LinearOperator.__iadd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__iadd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__sub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__sub__</span>


<a href="#torchfsm.operator.LinearOperator.__sub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__sub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__rsub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rsub__</span>


<a href="#torchfsm.operator.LinearOperator.__rsub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rsub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__isub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__isub__</span>


<a href="#torchfsm.operator.LinearOperator.__isub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__isub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__rmul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rmul__</span>


<a href="#torchfsm.operator.LinearOperator.__rmul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rmul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__imul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__imul__</span>


<a href="#torchfsm.operator.LinearOperator.__imul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__imul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__truediv__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__truediv__</span>


<a href="#torchfsm.operator.LinearOperator.__truediv__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__truediv__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.regisiter_additional_check" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">regisiter_additional_check</span>


<a href="#torchfsm.operator.LinearOperator.regisiter_additional_check" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">regisiter_additional_check</span><span class="p">(</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register an additional check function for the value and mesh compatibility.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="int">int</span>, <span title="int">int</span>], <span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that takes the dimension of the value and mesh as input and returns a boolean indicating whether they are compatible.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">regisiter_additional_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register an additional check function for the value and mesh compatibility.</span>

<span class="sd">    Args:</span>
<span class="sd">        func (Callable[[int, int], bool]): Function that takes the dimension of the value and mesh as input and returns a boolean indicating whether they are compatible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_value_mesh_check_func</span> <span class="o">=</span> <span class="n">func</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.add_generator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_generator</span>


<a href="#torchfsm.operator.LinearOperator.add_generator" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_generator</span><span class="p">(</span><span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorLike</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a generator to the operator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>generator</code>
            </td>
            <td>
                  <code><span title="torchfsm.operator._base.GeneratorLike">GeneratorLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generator to be added. It should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coef</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coefficient for the generator. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorLike</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a generator to the operator.</span>

<span class="sd">    Args:</span>
<span class="sd">        generator (GeneratorLike): Generator to be added. It should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</span>
<span class="sd">        coef (float): Coefficient for the generator. Default is 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.set_integrator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_integrator</span>


<a href="#torchfsm.operator.LinearOperator.set_integrator" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_integrator</span><span class="p">(</span>
    <span class="n">integrator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="n">ETDRKIntegrator</span><span class="p">,</span> <span class="n">RKIntegrator</span>
    <span class="p">],</span>
    <span class="o">**</span><span class="n">integrator_config</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the integrator for the operator. The integrator is used for time integration of the operator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>integrator</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;auto&#39;], <a class="autorefs autorefs-internal" title="            torchfsm.integrator.ETDRKIntegrator" href="../integrator/#torchfsm.integrator.ETDRKIntegrator">ETDRKIntegrator</a>, <a class="autorefs autorefs-internal" title="            torchfsm.integrator.RKIntegrator" href="../integrator/#torchfsm.integrator.RKIntegrator">RKIntegrator</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integrator to be used. If "auto", the integrator will be chosen automatically based on the operator type.
If "auto", the integrator will be set as ETDRKIntegrator.ETDRK0 for linear operators and ETDRKIntegrator.ETDRK4 for nonlinear operators.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**integrator_config</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional configuration for the integrator.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_integrator</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">integrator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="n">ETDRKIntegrator</span><span class="p">,</span> <span class="n">RKIntegrator</span><span class="p">],</span>
    <span class="o">**</span><span class="n">integrator_config</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the integrator for the operator. The integrator is used for time integration of the operator.</span>

<span class="sd">    Args:</span>
<span class="sd">        integrator (Union[Literal[&quot;auto&quot;], ETDRKIntegrator, RKIntegrator]): Integrator to be used. If &quot;auto&quot;, the integrator will be chosen automatically based on the operator type.</span>
<span class="sd">            If &quot;auto&quot;, the integrator will be set as ETDRKIntegrator.ETDRK0 for linear operators and ETDRKIntegrator.ETDRK4 for nonlinear operators.</span>
<span class="sd">        **integrator_config: Additional configuration for the integrator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">integrator</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="n">ETDRKIntegrator</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">integrator</span><span class="p">,</span> <span class="n">RKIntegrator</span>
        <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator</span> <span class="o">=</span> <span class="n">integrator</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span> <span class="o">=</span> <span class="n">integrator_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.integrate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">integrate</span>


<a href="#torchfsm.operator.LinearOperator.integrate" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">integrate</span><span class="p">(</span>
    <span class="n">u_0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_0_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progressive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">trajectory_recorder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TrajRecorder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
    <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Integrate the operator using the provided initial condition and time step.  </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u_0</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial condition in spatial domain. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_0_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial condition in Fourier domain. Default is None.
At least one of u_0 or u_0_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dt</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time step for the integrator. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of time steps to integrate. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. Default is None.
If None, the mesh registered in the operator will be used. You can use <code>register_mesh</code> to register a mesh before integration.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progressive</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, show a progress bar during integration. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trajectory_recorder</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            torchfsm.traj_recorder._TrajRecorder" href="../traj_recorder/#torchfsm.traj_recorder._TrajRecorder">_TrajRecorder</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Trajectory recorder for recording the trajectory during integration. Default is None.
If None, no trajectory will be recorded. The function will only return the final frame.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B T C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B T C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], SpatialTensor["B T C H ..."], FourierTensor["B C H ..."], FourierTensor["B T C H ..."]]: Integrated result in spatial or Fourier domain.
If trajectory_recorder is provided, the result will be a trajectory tensor of shape (B, T, C, H, ...). Otherwise, the result will be a tensor of shape (B, C, H, ...).
If return_in_fourier is True, the result will be in Fourier domain. Otherwise, it will be in spatial domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u_0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_0_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progressive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">trajectory_recorder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TrajRecorder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
        <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integrate the operator using the provided initial condition and time step.  </span>

<span class="sd">    Args:</span>
<span class="sd">        u_0 (Optional[torch.Tensor]): Initial condition in spatial domain. Default is None.</span>
<span class="sd">        u_0_fft (Optional[torch.Tensor]): Initial condition in Fourier domain. Default is None.</span>
<span class="sd">            At least one of u_0 or u_0_fft should be provided.</span>
<span class="sd">        dt (float): Time step for the integrator. Default is 1.</span>
<span class="sd">        step (int): Number of time steps to integrate. Default is 1.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">            If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before integration.</span>
<span class="sd">        progressive (bool): If True, show a progress bar during integration. Default is False.</span>
<span class="sd">        trajectory_recorder (Optional[_TrajRecorder]): Trajectory recorder for recording the trajectory during integration. Default is None.</span>
<span class="sd">            If None, no trajectory will be recorded. The function will only return the final frame.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], SpatialTensor[&quot;B T C H ...&quot;], FourierTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B T C H ...&quot;]]: Integrated result in spatial or Fourier domain.</span>
<span class="sd">            If trajectory_recorder is provided, the result will be a trajectory tensor of shape (B, T, C, H, ...). Otherwise, the result will be a tensor of shape (B, C, H, ...).</span>
<span class="sd">            If return_in_fourier is True, the result will be in Fourier domain. Otherwise, it will be in spatial domain.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_etdrk_integrator</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">f_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">u_0_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u_0_fft</span> <span class="o">=</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u_0</span><span class="p">)</span>
    <span class="n">p_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Integrating&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progressive</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p_bar</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
        <span class="n">u_0_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
        <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">return_in_fourier</span> <span class="o">=</span> <span class="n">return_in_fourier</span>
        <span class="k">return</span> <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">trajectory</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">u_0_fft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__call__</span>


<a href="#torchfsm.operator.LinearOperator.__call__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__call__</span><span class="p">(</span>
    <span class="nf">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Call the operator with the provided input tensor. The operator will apply the linear coefficient and nonlinear function to the input tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor in spatial domain. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.FourierTensor">FourierTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor in Fourier domain. Default is None.
At least one of u or u_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. Default is None.
If None, the mesh registered in the operator will be used. You can use <code>register_mesh</code> to register a mesh before calling the operator.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], FourierTensor["B C H ..."]]: Result of the operator in spatial or Fourier domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the operator with the provided input tensor. The operator will apply the linear coefficient and nonlinear function to the input tensor.</span>

<span class="sd">    Args:</span>
<span class="sd">        u (Optional[SpatialTensor]): Input tensor in spatial domain. Default is None.</span>
<span class="sd">        u_fft (Optional[FourierTensor]): Input tensor in Fourier domain. Default is None.</span>
<span class="sd">            At least one of u or u_fft should be provided.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">            If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before calling the operator.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B C H ...&quot;]]: Result of the operator in spatial or Fourier domain.</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_operator</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">u_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">value_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">](</span><span class="n">u_fft</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value_fft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">value_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.to" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to</span>


<a href="#torchfsm.operator.LinearOperator.to" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Move the operator to the specified device and change the data type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.device">device</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to which the operator should be moved. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.dtype">dtype</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the operator. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move the operator to the specified device and change the data type.</span>

<span class="sd">    Args:</span>
<span class="sd">        device (Optional[torch.device]): Device to which the operator should be moved. Default is None.</span>
<span class="sd">        dtype (Optional[torch.dtype]): Data type of the operator. Default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;n_channel&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__init__</span>


<a href="#torchfsm.operator.LinearOperator.__init__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span>
    <span class="nf">linear_coef</span><span class="p">:</span> <span class="n">ValueList</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">LinearCoef</span><span class="p">,</span> <span class="n">GeneratorLike</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">linear_coef</span><span class="p">:</span> <span class="n">ValueList</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">LinearCoef</span><span class="p">,</span> <span class="n">GeneratorLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linear_coef</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">linear_coef</span> <span class="o">=</span> <span class="p">[</span><span class="n">linear_coef</span><span class="p">]</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">operator_generators</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span>
                <span class="n">linear_coef_i</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linear_coef_i</span><span class="p">,</span> <span class="n">LinearCoef</span><span class="p">)</span>
                <span class="k">else</span> <span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">linear_coef_i</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">linear_coef_i</span> <span class="ow">in</span> <span class="n">linear_coef</span>
        <span class="p">],</span>
        <span class="n">coefs</span><span class="o">=</span><span class="n">coefs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__add__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__add__</span>


<a href="#torchfsm.operator.LinearOperator.__add__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__add__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">LinearOperator</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">LinearOperator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span>
            <span class="o">+</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">_ExplicitSourceCore</span><span class="p">(</span><span class="n">other</span><span class="p">)],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__mul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__mul__</span>


<a href="#torchfsm.operator.LinearOperator.__mul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__mul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">LinearOperator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="n">coef</span> <span class="o">*</span> <span class="n">other</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.LinearOperator.__neg__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__neg__</span>


<a href="#torchfsm.operator.LinearOperator.__neg__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__neg__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">LinearOperator</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">coef</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-class">



<h4 id="torchfsm.operator.NonlinearOperator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">torchfsm.operator.NonlinearOperator</span>


<a href="#torchfsm.operator.NonlinearOperator" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            torchfsm.operator.OperatorLike (torchfsm.operator._base.OperatorLike)" href="#torchfsm.operator.OperatorLike">OperatorLike</a></code>, <code><a class="autorefs autorefs-internal" title="            torchfsm.operator._base._DeAliasMixin" href="#torchfsm.operator._base._DeAliasMixin">_DeAliasMixin</a></code></p>


        <p>Operators that contain only nonlinear operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nonlinear_func</code>
            </td>
            <td>
                  <code><span title="torchfsm._type.ValueList">ValueList</span>[<span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="            torchfsm.operator.NonlinearFunc (torchfsm.operator._base.NonlinearFunc)" href="#torchfsm.operator.NonlinearFunc">NonlinearFunc</a>, <span title="torchfsm.operator._base.GeneratorLike">GeneratorLike</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of nonlinear function generators. Default is None.
Each generator should be a callable that takes a Fourier mesh and number of channels as input and returns a nonlinear function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coefs</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of coefficients for each nonlinear function generator. Default is None.
If None, all coefficients are set to 1.
The length of the list should match the number of nonlinear function generators.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NonlinearOperator</span><span class="p">(</span><span class="n">OperatorLike</span><span class="p">,</span> <span class="n">_DeAliasMixin</span><span class="p">):</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Operators that contain only nonlinear operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        nonlinear_func (ValueList[Union[NonlinearFunc, GeneratorLike]]): List of nonlinear function generators. Default is None.</span>
<span class="sd">            Each generator should be a callable that takes a Fourier mesh and number of channels as input and returns a nonlinear function.</span>
<span class="sd">        coefs (Optional[List]): List of coefficients for each nonlinear function generator. Default is None.</span>
<span class="sd">            If None, all coefficients are set to 1.</span>
<span class="sd">            The length of the list should match the number of nonlinear function generators.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nonlinear_func</span><span class="p">:</span> <span class="n">ValueList</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">NonlinearFunc</span><span class="p">,</span> <span class="n">GeneratorLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nonlinear_func</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">nonlinear_func</span> <span class="o">=</span> <span class="p">[</span><span class="n">nonlinear_func</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">operator_generators</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">nonlinear_func_i</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nonlinear_func_i</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">)</span>
                    <span class="k">else</span> <span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">nonlinear_func_i</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">nonlinear_func_i</span> <span class="ow">in</span> <span class="n">nonlinear_func</span>
            <span class="p">],</span>
            <span class="n">coefs</span><span class="o">=</span><span class="n">coefs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">NonlinearOperator</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">NonlinearOperator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span>
                <span class="o">+</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">_ExplicitSourceCore</span><span class="p">(</span><span class="n">other</span><span class="p">)],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NonlinearOperator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="n">coef</span> <span class="o">*</span> <span class="n">other</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NonlinearOperator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">coef</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.NonlinearOperator.operator_generators" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">operator_generators</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#torchfsm.operator.NonlinearOperator.operator_generators" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">operator_generators</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.NonlinearOperator.coefs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">coefs</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#torchfsm.operator.NonlinearOperator.coefs" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">coefs</span> <span class="o">=</span> <span class="n">default</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">operator_generators</span><span class="p">))</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="torchfsm.operator.NonlinearOperator.is_linear" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_linear</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#torchfsm.operator.NonlinearOperator.is_linear" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_linear</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.set_de_aliasing_rate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_de_aliasing_rate</span>


<a href="#torchfsm.operator.NonlinearOperator.set_de_aliasing_rate" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_de_aliasing_rate</span><span class="p">(</span><span class="n">de_aliasing_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the de-aliasing rate for the nonlinear operator.
Args:
    de_aliasing_rate (float): De-aliasing rate. Default is &#8532;.</p>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_de_aliasing_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">de_aliasing_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the de-aliasing rate for the nonlinear operator.</span>
<span class="sd">    Args:</span>
<span class="sd">        de_aliasing_rate (float): De-aliasing rate. Default is 2/3.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_de_aliasing_rate</span> <span class="o">=</span> <span class="n">de_aliasing_rate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__radd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__radd__</span>


<a href="#torchfsm.operator.NonlinearOperator.__radd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__radd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__iadd__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__iadd__</span>


<a href="#torchfsm.operator.NonlinearOperator.__iadd__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__iadd__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__sub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__sub__</span>


<a href="#torchfsm.operator.NonlinearOperator.__sub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__sub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__rsub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rsub__</span>


<a href="#torchfsm.operator.NonlinearOperator.__rsub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rsub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__isub__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__isub__</span>


<a href="#torchfsm.operator.NonlinearOperator.__isub__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__isub__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__rmul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__rmul__</span>


<a href="#torchfsm.operator.NonlinearOperator.__rmul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__rmul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__imul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__imul__</span>


<a href="#torchfsm.operator.NonlinearOperator.__imul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__imul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__truediv__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__truediv__</span>


<a href="#torchfsm.operator.NonlinearOperator.__truediv__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__truediv__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.register_mesh" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">register_mesh</span>


<a href="#torchfsm.operator.NonlinearOperator.register_mesh" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">register_mesh</span><span class="p">(</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
        <span class="n">MeshGrid</span><span class="p">,</span>
        <span class="n">FourierMesh</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register the mesh and number of channels for the operator. Once a mesh is registered, mesh information is not required for integration and operator call.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_channel</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of channels of the input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.device">device</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to which the mesh should be moved. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.dtype">dtype</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the mesh. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">register_mesh</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">],</span>
    <span class="n">n_channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register the mesh and number of channels for the operator. Once a mesh is registered, mesh information is not required for integration and operator call.</span>

<span class="sd">    Args:</span>
<span class="sd">        mesh (Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]): Mesh information or mesh object.</span>
<span class="sd">        n_channel (int): Number of channels of the input tensor.</span>
<span class="sd">        device (Optional[torch.device]): Device to which the mesh should be moved. Default is None.</span>
<span class="sd">        dtype (Optional[torch.dtype]): Data type of the mesh. Default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">):</span>
        <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">mesh</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f_mesh</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f_mesh</span> <span class="o">=</span> <span class="n">FourierMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;f_mesh&quot;</span><span class="p">:</span> <span class="n">f_mesh</span><span class="p">,</span>
            <span class="s2">&quot;n_channel&quot;</span><span class="p">:</span> <span class="n">n_channel</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">linear_coefs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nonlinear_funcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">generator</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">LinearCoef</span><span class="p">):</span>
            <span class="n">linear_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">):</span>
            <span class="n">nonlinear_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coef</span><span class="p">,</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operator </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2"> is not supported&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span> <span class="o">=</span> <span class="n">nonlinear_funcs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_linear_coefs</span><span class="p">(</span><span class="n">linear_coefs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_nonlinear_funcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_funcs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.regisiter_additional_check" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">regisiter_additional_check</span>


<a href="#torchfsm.operator.NonlinearOperator.regisiter_additional_check" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">regisiter_additional_check</span><span class="p">(</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register an additional check function for the value and mesh compatibility.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="int">int</span>, <span title="int">int</span>], <span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that takes the dimension of the value and mesh as input and returns a boolean indicating whether they are compatible.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">regisiter_additional_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register an additional check function for the value and mesh compatibility.</span>

<span class="sd">    Args:</span>
<span class="sd">        func (Callable[[int, int], bool]): Function that takes the dimension of the value and mesh as input and returns a boolean indicating whether they are compatible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_value_mesh_check_func</span> <span class="o">=</span> <span class="n">func</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.add_generator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_generator</span>


<a href="#torchfsm.operator.NonlinearOperator.add_generator" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_generator</span><span class="p">(</span><span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorLike</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a generator to the operator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>generator</code>
            </td>
            <td>
                  <code><span title="torchfsm.operator._base.GeneratorLike">GeneratorLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generator to be added. It should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coef</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coefficient for the generator. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="n">GeneratorLike</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a generator to the operator.</span>

<span class="sd">    Args:</span>
<span class="sd">        generator (GeneratorLike): Generator to be added. It should be a callable that takes a Fourier mesh and number of channels as input and returns a linear coefficient or nonlinear function.</span>
<span class="sd">        coef (float): Coefficient for the generator. Default is 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.set_integrator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_integrator</span>


<a href="#torchfsm.operator.NonlinearOperator.set_integrator" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_integrator</span><span class="p">(</span>
    <span class="n">integrator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="n">ETDRKIntegrator</span><span class="p">,</span> <span class="n">RKIntegrator</span>
    <span class="p">],</span>
    <span class="o">**</span><span class="n">integrator_config</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the integrator for the operator. The integrator is used for time integration of the operator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>integrator</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;auto&#39;], <a class="autorefs autorefs-internal" title="            torchfsm.integrator.ETDRKIntegrator" href="../integrator/#torchfsm.integrator.ETDRKIntegrator">ETDRKIntegrator</a>, <a class="autorefs autorefs-internal" title="            torchfsm.integrator.RKIntegrator" href="../integrator/#torchfsm.integrator.RKIntegrator">RKIntegrator</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integrator to be used. If "auto", the integrator will be chosen automatically based on the operator type.
If "auto", the integrator will be set as ETDRKIntegrator.ETDRK0 for linear operators and ETDRKIntegrator.ETDRK4 for nonlinear operators.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**integrator_config</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional configuration for the integrator.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_integrator</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">integrator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="n">ETDRKIntegrator</span><span class="p">,</span> <span class="n">RKIntegrator</span><span class="p">],</span>
    <span class="o">**</span><span class="n">integrator_config</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the integrator for the operator. The integrator is used for time integration of the operator.</span>

<span class="sd">    Args:</span>
<span class="sd">        integrator (Union[Literal[&quot;auto&quot;], ETDRKIntegrator, RKIntegrator]): Integrator to be used. If &quot;auto&quot;, the integrator will be chosen automatically based on the operator type.</span>
<span class="sd">            If &quot;auto&quot;, the integrator will be set as ETDRKIntegrator.ETDRK0 for linear operators and ETDRKIntegrator.ETDRK4 for nonlinear operators.</span>
<span class="sd">        **integrator_config: Additional configuration for the integrator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">integrator</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="n">ETDRKIntegrator</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">integrator</span><span class="p">,</span> <span class="n">RKIntegrator</span>
        <span class="p">),</span> <span class="s2">&quot;The integrator should be &#39;auto&#39; or an instance of ETDRKIntegrator or RKIntegrator&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator</span> <span class="o">=</span> <span class="n">integrator</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrator_config</span> <span class="o">=</span> <span class="n">integrator_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.integrate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">integrate</span>


<a href="#torchfsm.operator.NonlinearOperator.integrate" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">integrate</span><span class="p">(</span>
    <span class="n">u_0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_0_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progressive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">trajectory_recorder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TrajRecorder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
    <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
    <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Integrate the operator using the provided initial condition and time step.  </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u_0</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial condition in spatial domain. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_0_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial condition in Fourier domain. Default is None.
At least one of u_0 or u_0_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dt</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time step for the integrator. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of time steps to integrate. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. Default is None.
If None, the mesh registered in the operator will be used. You can use <code>register_mesh</code> to register a mesh before integration.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progressive</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, show a progress bar during integration. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trajectory_recorder</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            torchfsm.traj_recorder._TrajRecorder" href="../traj_recorder/#torchfsm.traj_recorder._TrajRecorder">_TrajRecorder</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Trajectory recorder for recording the trajectory during integration. Default is None.
If None, no trajectory will be recorded. The function will only return the final frame.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B T C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B T C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], SpatialTensor["B T C H ..."], FourierTensor["B C H ..."], FourierTensor["B T C H ..."]]: Integrated result in spatial or Fourier domain.
If trajectory_recorder is provided, the result will be a trajectory tensor of shape (B, T, C, H, ...). Otherwise, the result will be a tensor of shape (B, C, H, ...).
If return_in_fourier is True, the result will be in Fourier domain. Otherwise, it will be in spatial domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u_0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_0_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progressive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">trajectory_recorder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TrajRecorder</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
        <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span>
        <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B T C H ...&quot;</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integrate the operator using the provided initial condition and time step.  </span>

<span class="sd">    Args:</span>
<span class="sd">        u_0 (Optional[torch.Tensor]): Initial condition in spatial domain. Default is None.</span>
<span class="sd">        u_0_fft (Optional[torch.Tensor]): Initial condition in Fourier domain. Default is None.</span>
<span class="sd">            At least one of u_0 or u_0_fft should be provided.</span>
<span class="sd">        dt (float): Time step for the integrator. Default is 1.</span>
<span class="sd">        step (int): Number of time steps to integrate. Default is 1.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">            If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before integration.</span>
<span class="sd">        progressive (bool): If True, show a progress bar during integration. Default is False.</span>
<span class="sd">        trajectory_recorder (Optional[_TrajRecorder]): Trajectory recorder for recording the trajectory during integration. Default is None.</span>
<span class="sd">            If None, no trajectory will be recorded. The function will only return the final frame.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], SpatialTensor[&quot;B T C H ...&quot;], FourierTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B T C H ...&quot;]]: Integrated result in spatial or Fourier domain.</span>
<span class="sd">            If trajectory_recorder is provided, the result will be a trajectory tensor of shape (B, T, C, H, ...). Otherwise, the result will be a tensor of shape (B, C, H, ...).</span>
<span class="sd">            If return_in_fourier is True, the result will be in Fourier domain. Otherwise, it will be in spatial domain.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u_0</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_etdrk_integrator</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_integrator</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">f_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">u_0_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u_0_fft</span> <span class="o">=</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u_0</span><span class="p">)</span>
    <span class="n">p_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Integrating&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progressive</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p_bar</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
        <span class="n">u_0_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;integrator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trajectory_recorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">u_0_fft</span><span class="p">)</span>
        <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">return_in_fourier</span> <span class="o">=</span> <span class="n">return_in_fourier</span>
        <span class="k">return</span> <span class="n">trajectory_recorder</span><span class="o">.</span><span class="n">trajectory</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">u_0_fft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f_mesh</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">u_0_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__call__</span>


<a href="#torchfsm.operator.NonlinearOperator.__call__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__call__</span><span class="p">(</span>
    <span class="nf">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
            <span class="n">MeshGrid</span><span class="p">,</span>
            <span class="n">FourierMesh</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Call the operator with the provided input tensor. The operator will apply the linear coefficient and nonlinear function to the input tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor in spatial domain. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_fft</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torchfsm._type.FourierTensor">FourierTensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input tensor in Fourier domain. Default is None.
At least one of u or u_fft should be provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="int">int</span>]], <span title="torchfsm.mesh.MeshGrid">MeshGrid</span>, <span title="torchfsm.mesh.FourierMesh">FourierMesh</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh information or mesh object. Default is None.
If None, the mesh registered in the operator will be used. You can use <code>register_mesh</code> to register a mesh before calling the operator.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_in_fourier</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torchfsm._type.SpatialTensor">SpatialTensor</span>[&#39;B C H ...&#39;], <span title="torchfsm._type.FourierTensor">FourierTensor</span>[&#39;B C H ...&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[SpatialTensor["B C H ..."], FourierTensor["B C H ..."]]: Result of the operator in spatial or Fourier domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">u_fft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MeshGrid</span><span class="p">,</span> <span class="n">FourierMesh</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_in_fourier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpatialTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">],</span> <span class="n">FourierTensor</span><span class="p">[</span><span class="s2">&quot;B C H ...&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the operator with the provided input tensor. The operator will apply the linear coefficient and nonlinear function to the input tensor.</span>

<span class="sd">    Args:</span>
<span class="sd">        u (Optional[SpatialTensor]): Input tensor in spatial domain. Default is None.</span>
<span class="sd">        u_fft (Optional[FourierTensor]): Input tensor in Fourier domain. Default is None.</span>
<span class="sd">            At least one of u or u_fft should be provided.</span>
<span class="sd">        mesh (Optional[Union[Sequence[tuple[float, float, int]], MeshGrid, FourierMesh]]): Mesh information or mesh object. Default is None.</span>
<span class="sd">            If None, the mesh registered in the operator will be used. You can use `register_mesh` to register a mesh before calling the operator.</span>
<span class="sd">        return_in_fourier (bool): If True, return the result in Fourier domain. If False, return the result in spatial domain. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[SpatialTensor[&quot;B C H ...&quot;], FourierTensor[&quot;B C H ...&quot;]]: Result of the operator in spatial or Fourier domain.</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_check</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">u_fft</span><span class="o">=</span><span class="n">u_fft</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_operator</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">u_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">u_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">value_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">](</span><span class="n">u_fft</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_in_fourier</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value_fft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">value_fft</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.to" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to</span>


<a href="#torchfsm.operator.NonlinearOperator.to" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Move the operator to the specified device and change the data type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.device">device</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to which the operator should be moved. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.dtype">dtype</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the operator. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move the operator to the specified device and change the data type.</span>

<span class="sd">    Args:</span>
<span class="sd">        device (Optional[torch.device]): Device to which the operator should be moved. Default is None.</span>
<span class="sd">        dtype (Optional[torch.dtype]): Data type of the operator. Default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;f_mesh&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;n_channel&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__init__</span>


<a href="#torchfsm.operator.NonlinearOperator.__init__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span>
    <span class="nf">nonlinear_func</span><span class="p">:</span> <span class="n">ValueList</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">NonlinearFunc</span><span class="p">,</span> <span class="n">GeneratorLike</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nonlinear_func</span><span class="p">:</span> <span class="n">ValueList</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">NonlinearFunc</span><span class="p">,</span> <span class="n">GeneratorLike</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">coefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nonlinear_func</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">nonlinear_func</span> <span class="o">=</span> <span class="p">[</span><span class="n">nonlinear_func</span><span class="p">]</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">operator_generators</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span>
                <span class="n">nonlinear_func_i</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nonlinear_func_i</span><span class="p">,</span> <span class="n">NonlinearFunc</span><span class="p">)</span>
                <span class="k">else</span> <span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">nonlinear_func_i</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">nonlinear_func_i</span> <span class="ow">in</span> <span class="n">nonlinear_func</span>
        <span class="p">],</span>
        <span class="n">coefs</span><span class="o">=</span><span class="n">coefs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__add__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__add__</span>


<a href="#torchfsm.operator.NonlinearOperator.__add__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__add__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">NonlinearOperator</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NonlinearOperator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Operator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span>
            <span class="o">+</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">f_mesh</span><span class="p">,</span> <span class="n">n_channel</span><span class="p">:</span> <span class="n">_ExplicitSourceCore</span><span class="p">(</span><span class="n">other</span><span class="p">)],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__mul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__mul__</span>


<a href="#torchfsm.operator.NonlinearOperator.__mul__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__mul__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OperatorLike</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">NonlinearOperator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="n">coef</span> <span class="o">*</span> <span class="n">other</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="torchfsm.operator.NonlinearOperator.__neg__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__neg__</span>


<a href="#torchfsm.operator.NonlinearOperator.__neg__" class="headerlink" title="Permanent link">¤</a></h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__neg__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>torchfsm/operator/_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">NonlinearOperator</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator_generators</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">coef</span> <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span><span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../utils/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 8. utils">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                8. utils
              </div>
            </div>
          </a>
        
        
          
          <a href="../operator_core/" class="md-footer__link md-footer__link--next" aria-label="Next: Cores">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Cores
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/qiauil/torchfsm" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate", "toc.follow", "navigation.top", "navigation.path", "navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "navigation.instant.progress", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS_CHTML"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
    
  </body>
</html>